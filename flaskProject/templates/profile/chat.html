{% extends 'base.html' %}
{% block link %}
  <link rel="stylesheet" href="../../static/css/base.css">
  <link rel="stylesheet" href="../../static/css/chat.css">
{% endblock %}
{% block content %}
<div class="container mt-4">
    <h3 class="mb-4">Chat with {{ user.username }}</h3>
    <div class="card">
        <div class="card-body chat-box" style="height: 400px; overflow-y: auto; background-color: #f8f9fa;">
            {% for message in messages %}
                <div class="d-flex mb-3 {% if message.sender_id == current_user.id %}justify-content-end{% else %}justify-content-start{% endif %}">
                    <div class="position-relative p-2 rounded"
                         style="max-width: 70%;
                                background-color: {% if message.sender_id == current_user.id %}#0d6efd; color: white;{% else %}#e9ecef; color: black;{% endif %}">
                        <div>{{ message.content }}</div>
                        <small class="position-absolute"
                               style="font-size: 0.65rem; bottom: 5px; right: 8px; color: {% if message.sender_id == current_user.id %}#cce5ff{% else %}#6c757d{% endif %};">
                            {{ message.timestamp.strftime('%H:%M %d-%m-%Y') }}
                        </small>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <form method="POST" action="{{ url_for('profile.send_message', user_id=user.id) }}" class="d-flex mt-3">
        <input type="text" name="message" class="form-control me-2" placeholder="Type your message..." required>
        <button class="btn btn-primary" type="submit">Send</button>
    </form>
</div>

<script>
    const chatBox = document.querySelector('.chat-box');
    chatBox.scrollTop = chatBox.scrollHeight;
</script>
{% endblock %}
